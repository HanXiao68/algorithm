### 分布式事务的场景：
    电商的回调支付场景。
    1.订单服务：在下订单的时候，需要对库存服务进行update。
    2.要解决夸服务之间的调用。就要用到分布式事务。ACID：CI用的锁。 AD用的是日志（redo log,undo log）。数据丢了没关系，可以用日志把数据给恢复出来。commit就是把事务处理玩的数据直接刷到磁盘上。
    3.微服务中，多个服务调用一个库。
    4.操作多个库。
ACID：
    怎么保证一致性：
        AD：undolog,redolog
        CI：通过锁来实现。

CAP:一致性，可用性，分区容错性。一般选AP，p一定要选，分布式的分区一致性。

一阶段：顺序执行。、
二阶段：加了事务协调器
三阶段：加了超时机制。预提交的时候中断，就不会执行后面真正的提交。

二三阶段不能保证数据一致性。所以需要人工补偿。
二阶段提交协议：（需要第三方来进行事务协调）
    保证了分布式事务的原子性。所有的事务要么全执行，要么全不执行。
三阶段提交协议：
    
事务的回滚：利用日志的回滚。redolog，undolog。


（https://www.douban.com/note/208430424/）
  
  paxos：解决了拜占庭将军的问题。投票过半数才能算数，超过半数后就能成为法令。提议的编号只能自增。
    过半通过，两阶段提交（1阶段：写到磁盘日志。2阶段：写到内存）。   
    zookeeper也是基于内存的。选主的过程中，拒绝其他请求。
    ZAB（zookeeper原子广播），主从模型是zookeeper实现的paxos协议。leader的消息发送维护了一个队列。把消息队列中的数据最后处理完，体现了最终一致性。














